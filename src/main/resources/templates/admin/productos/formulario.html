<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{layout/plantilla :: head('Dark Boutique - Formulario de Producto')}"></head>
<body>
  <!-- HEADER común -->
  <div th:replace="~{layout/plantilla :: header}"></div>

  <!-- FLASH MESSAGE -->
  <div th:replace="~{layout/plantilla :: flash}"></div>

  <!-- Contenido específico -->
  <main class="container mt-4" th:fragment="mainContent">
    <h2 th:text="${producto.id == null} ? 'Agregar Producto' : 'Editar Producto'">
      Formulario Producto
    </h2>

    <form th:action="@{/admin/productos/guardar}"
          th:object="${producto}"
          method="post"
          enctype="multipart/form-data"
          class="needs-validation"
          novalidate>
      <!-- ID oculto para edición -->
      <input type="hidden"
             th:if="${producto.id != null}"
             th:field="*{id}" />

      <div class="mb-3">
        <label for="nombre" class="form-label">Nombre:</label>
        <input type="text" id="nombre"
               th:field="*{nombre}"
               class="form-control"
               placeholder="Nombre del producto"
               required />
        <div class="invalid-feedback">
          El nombre es obligatorio.
        </div>
      </div>

      <div class="mb-3">
        <label for="descripcion" class="form-label">Descripción:</label>
        <textarea id="descripcion"
                  th:field="*{descripcion}"
                  class="form-control"
                  rows="3"
                  placeholder="Descripción del producto"
                  required></textarea>
        <div class="invalid-feedback">
          La descripción es obligatoria.
        </div>
      </div>

      <div class="mb-3">
        <label for="precio" class="form-label">Precio:</label>
        <input type="number" id="precio"
               th:field="*{precio}"
               class="form-control"
               step="0.01"
               placeholder="0.00"
               required />
        <div class="invalid-feedback">
          El precio es obligatorio.
        </div>
      </div>

      <div class="mb-3"
           th:if="${producto.imagenUrl != null and !#strings.isEmpty(producto.imagenUrl)}">
        <label class="form-label">Imagen Actual:</label><br/>
        <img th:src="@{${producto.imagenUrl}}"
             alt="Imagen del producto"
             class="img-thumbnail"
             style="max-width:200px;" />
      </div>

      <div class="mb-3">
        <label for="imagen" class="form-label">Seleccionar Imagen:</label>
        <input type="file" id="imagen"
               name="imagen"
               accept="image/*"
               class="form-control" />
      </div>

      <div class="mb-3">
        <label for="categoria" class="form-label">Categoría:</label>
        <select id="categoria"
                th:field="*{categoria}"
                class="form-select"
                required>
          <option value="" disabled
                  th:if="${producto.categoria == null}">
            -- Seleccione --
          </option>
          <option value="hombre"
                  th:selected="${producto.categoria == 'hombre'}">
            Hombre
          </option>
          <option value="mujer"
                  th:selected="${producto.categoria == 'mujer'}">
            Mujer
          </option>
          <option value="gorras"
                  th:selected="${producto.categoria == 'gorras'}">
            Gorras
          </option>
          <option value="promociones"
                  th:selected="${producto.categoria == 'promociones'}">
            Promociones
          </option>
        </select>
        <div class="invalid-feedback">
          La categoría es obligatoria.
        </div>
      </div>

      <button type="submit" class="btn btn-primary">
        Guardar
      </button>
      <a th:href="@{/admin/productos}"
         class="btn btn-secondary ms-2">
        Cancelar
      </a>
    </form>
  </main>

  <!-- FOOTER común -->
  <div th:replace="~{layout/plantilla :: footer}"></div>

  <!-- Validación de formulario Bootstrap -->
  <script>
    (() => {
      'use strict';
      const forms = document.querySelectorAll('.needs-validation');
      Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    })();
  </script>

  <script th:src="@{/webjars/bootstrap/5.3.3/js/bootstrap.bundle.min.js}"></script>
</body>
</html>
